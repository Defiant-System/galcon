let Anim={init(t){this.images=[];this.planets=[];this.paused=false;this.TAU=Math.PI*2},dispatch(t){let a=Anim,e;switch(t.type){case"start":a.cvs=t.canvas;a.ctx=a.cvs.getContext("2d");a.width=a.cvs.width;a.height=a.cvs.height;a.dispatch({type:"create-scene"});break;case"pause":a.paused=true;break;case"resume":if(a.paused&&a.ctx){a.paused=false;a.draw()}break;case"create-scene":let e=new Request("/app/ant/galcon/img/bg-02.jpg");fetch(e).then((async t=>{let e=await t.blob(),s=await createImageBitmap(e);a.bgImage=s;a.bgRotation=0;a.draw()}));a.maxDepth=64;a.stars=[];let s=128;while(s--){a.stars.push({x:Utils.random(-25,25)|0,y:Utils.random(-25,25)|0,z:Utils.random(1,a.maxDepth)|0})}break;case"add-planets":a.planets=t.planets.map((t=>{let a=Math.random()*90-45|0,e=Math.random()*(Object.keys(Surface.maps).length-1)|0,s=Math.random()*.5-.25;return{...t,tilt:a,texture:e,speed:s,rotation:0}}));break;case"clear-planets":a.planets=[];break}},update(t){let a=t.width/2,e=t.height/2,s=t.stars,i=s.length;while(i--){s[i].z-=.005;if(s[i].z<=0){s[i].x=Utils.random(-25,25)|0;s[i].y=Utils.random(-25,25)|0;s[i].z=Utils.random(1,t.maxDepth)|0}}t.bgRotation+=5e-5},draw(){let t=Anim,a=t.cvs,e=t.ctx,s=t.width>>1,i=t.height>>1,r=t.stars,h=r.length;t.update(t);a.width=t.width;a.height=t.height;e.save();e.translate(s,i);e.rotate(t.bgRotation);e.drawImage(t.bgImage,-512,-512);e.restore();while(h--){k=128/r[h].z,px=r[h].x*k+s,py=r[h].y*k+i;if(px>=0&&px<=t.width&&py>=0&&py<=t.height){let a=1-r[h].z/48,s=Math.max(a,.1)+.45,i=255-Math.round(Math.abs(a*32));e.beginPath();e.fillStyle=`rgba(${i}, ${i}, ${i}, ${a})`;e.arc(px,py,s,0,t.TAU);e.fill()}}if(!t.paused)requestAnimationFrame(t.draw)}};Anim.init();self.onmessage=t=>Anim.dispatch(t.data);let Utils={random(t,a){return Math.random()*(a-t)+t},calculateDistance(t,a,e,s){let i=t-e,r=a-s;return Math.sqrt(i**2+r**2)}};